---
title: 权限设计
date: 2023-11-22
editLink: false
footer: false
isOriginal: true
category:
  - 工具箱
tag:
  - 权限设计
---

应用程序中常用权限，又如何设计权限。

常用的权限有`菜单权限`、`功能权限`以及`数据权限`

## 菜单权限

菜单权限比较好实现，其一，菜单不会很多，其二当页面展示时就基本不会在变，相对固定。

多级菜单时只要确认最末级的菜单权限ID即可。

- 菜单表

|权限ID|菜单名称|
|:-|:-|
|M1|菜单1|
|M2|菜单2|
|...|...|

- 用户表

|用户ID|用户名|
|:-|:-|
|U1|用户1|
|U2|用户2|
|...|...|

- 用户菜单权限表

|用户ID|菜单ID|
|:-|:-|
|U1|M1|
|U1|M2|
|U2|M1|

通过`sql`语句`inner join`关联得到当前用户的菜单即可

### 多级菜单

相关代码参考[WPF插件](../../cs/wpf/plugin.md)

多级菜单相对单级菜单复杂，如果是固定的多级菜单就简单多了。

不确定的多级菜单需要进行好的设计，通过迭代生成。

关键在于`迭代`,为了使表设计满足迭代，表结构需要满足一定的要求，如下所示

- 多级菜单表

|权限ID|菜单级别|菜单名称|是否末级|
|:-|:-|:-|:-|
|M1|1|菜单1|0|
|M2|1|菜单2|0|
|M101|2|菜单3|0|
|M10101|3|菜单4|1|
|M201|2|菜单5|1|
|M102|2|菜单6|1|

这里多添加一个`菜单级别字段`和调整`权限ID`约束实现

- 菜单级别显示当前菜单的层次
- 每层菜单级别数对应长度为`2`的菜单ID
- 每层的权限ID能反应出上层菜单权限ID

最终展示的菜单如下

```txt
|--菜单1
|----菜单3
|------菜单4
|----菜单6
|--菜单2
|----菜单5
```

::: tips

当菜单非常多时，可以将所有的1级菜单统计到单独表，进行归类。

当菜单深度很深时，只显示顶层菜单，点击时在加载子菜单。
:::

## 功能权限

## 数据权限

数据权限就是用户能看到什么数据，这个只要对表字段进行权限控制，动态生成即可。

- 数据表

|字段名|字段描述|
|:-|:-|
|Name|姓名|
|Address|地址|
|Phone|电话|

- 数据权限表

|Key|ID|字段|
|:-|:-|:-|
|01|1|Name|
|01|2|Address|
|01|3|Phone|

- 用户数据权限表

|用户ID|数据权限ID|
|:-|:-|
|U1|1|
|U1|2|

通过数据权限表和用户权限表关联，即能查询出当前用户的可见数据，并且可以扩展显示顺序、别名等功能。
